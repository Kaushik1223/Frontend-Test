import React, { useState } from 'react';
import { PDFDocument } from 'pdf-lib';

const MergeButton = ({ onFileUpload }) => {
  const [mergedPdf, setMergedPdf] = useState(null);

  const handleMergeClick = () => {
    document.getElementById('merge-file-input').click();
  };

  const handleMergeFileSelect = async (event) => {
    const files = event.target.files;
    const pdfDoc = await PDFDocument.create();

    for (const file of files) {
      const existingPdfBytes = await file.arrayBuffer();
      const existingPdf = await PDFDocument.load(existingPdfBytes);
      const copiedPages = await pdfDoc.copyPages(existingPdf, existingPdf.getPageIndices());
      copiedPages.forEach((page) => pdfDoc.addPage(page));
    }

    const mergedPdfBytes = await pdfDoc.save();
    const mergedBlob = new Blob([mergedPdfBytes], { type: 'application/pdf' });

    setMergedPdf(mergedBlob);
    onFileUpload('invoice', mergedBlob); // Upload the merged PDF
  };

  return (
    <div className="merge-section">
      <button onClick={handleMergeClick} className="merge-button">Merge PDFs</button>
      <input
        type="file"
        id="merge-file-input"
        style={{ display: 'none' }}
        accept="application/pdf"
        multiple
        onChange={handleMergeFileSelect}
      />
    </div>
  );
};

export default MergeButton;
