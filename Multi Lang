const transformDataForCSV = (message) => {
    const transformedData = [];

    if (message && Array.isArray(message.Differences)) {
        message.Differences.forEach((difference) => {
            const account = difference.Account;

            if (difference.Result && Array.isArray(difference.Result)) {
                difference.Result.forEach((result) => {
                    const sorColumn = Object.keys(result.Differences || {})[0];
                    const sorData = sorColumn ? result.Differences[sorColumn]?.Excel : '';
                    const invoiceData = sorColumn ? result.Differences[sorColumn]?.PDF : '';

                    const row = {
                        'Account No.': account || '',
                        'Transaction no.': result['Transaction Number'] || '',
                        'Type of Confirmation': result.Confirmation || '',
                        'SOR Column': sorColumn || '',
                        'SOR Data': sorData || '',
                        'Invoice data': invoiceData || ''
                    };

                    transformedData.push(row);
                });
            }
        });
    } else {
        console.error("Invalid message format or Differences is not an array");
    }

    console.log("Transformed data for CSV:", transformedData); // Debugging line
    return transformedData;
};
