const handleExport = async (format) => {
    if (!message || Object.keys(message).length === 0) {
        console.log("No message to export!");
        return;
    }

    let fileContent;
    let fileType;
    let fileName;

    if (format === 'json') {
        fileContent = JSON.stringify(message); // Removed the indentation for compact JSON
        fileType = 'application/json';
        fileName = 'result.json';
    } else if (format === 'csv') {
        try {
            fileContent = await json2csv(message);
            fileType = 'text/csv';
            fileName = 'result.csv';
        } catch (err) {
            console.error("Error converting JSON to CSV", err);
            return;
        }
    }

    const element = document.createElement("a");
    const file = new Blob([fileContent], { type: fileType });

    element.href = URL.createObjectURL(file);
    element.download = fileName;
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element); // Clean up
};
