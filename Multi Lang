import React, { useState } from 'react';

const TreeNode = ({ node }) => {
  const [expandedAccount, setExpandedAccount] = useState(false);
  const [expandedTransaction, setExpandedTransaction] = useState({});
  const [expandedConfirmation, setExpandedConfirmation] = useState({});
  const [expandedDifference, setExpandedDifference] = useState({});

  const toggleExpandAccount = () => setExpandedAccount(!expandedAccount);
  const toggleExpandTransaction = (index) =>
    setExpandedTransaction((prev) => ({ ...prev, [index]: !prev[index] }));
  const toggleExpandConfirmation = (index) =>
    setExpandedConfirmation((prev) => ({ ...prev, [index]: !prev[index] }));
  const toggleExpandDifference = (index) =>
    setExpandedDifference((prev) => ({ ...prev, [index]: !prev[index] }));

  const renderDifferencesTable = (differences) => (
    <table style={{ marginLeft: '20px' }}>
      <thead>
        <tr>
          <th>Excel</th>
          <th>PDF</th>
        </tr>
      </thead>
      <tbody>
        {Object.entries(differences).map(([key, value], index) => (
          <tr key={index}>
            <td>{value.Excel}</td>
            <td>{value.PDF}</td>
          </tr>
        ))}
      </tbody>
    </table>
  );

  const renderAccountDetails = (account) => (
    <div>
      <div style={{ fontWeight: 'bold', cursor: 'pointer' }} onClick={toggleExpandAccount}>
        Account no: {account.Account} {expandedAccount ? '-' : '+'}
      </div>
      {expandedAccount && (
        <div style={{ marginLeft: '20px' }}>
          {account.Result.map((result, index) => (
            <div key={index}>
              <div style={{ cursor: 'pointer' }} onClick={() => toggleExpandTransaction(index)}>
                Transaction no: {result['Transaction Number']} {expandedTransaction[index] ? '-' : '+'}
              </div>
              {expandedTransaction[index] && (
                <div style={{ marginLeft: '20px' }}>
                  <div
                    style={{ cursor: 'pointer' }}
                    onClick={() => toggleExpandConfirmation(index)}
                  >
                    Type of Confirmation: {result.Confirmation} {expandedConfirmation[index] ? '-' : '+'}
                  </div>
                  {expandedConfirmation[index] && (
                    <div style={{ marginLeft: '20px' }}>
                      <div style={{ cursor: 'pointer' }} onClick={() => toggleExpandDifference(index)}>
                        Difference {expandedDifference[index] ? '-' : '+'}
                      </div>
                      {expandedDifference[index] && renderDifferencesTable(result.Differences)}
                    </div>
                  )}
                </div>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  );

  return <div className="tree-node">{renderAccountDetails(node)}</div>;
};

export default TreeNode;
